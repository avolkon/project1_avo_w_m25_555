# def main():
#     """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã."""
#     print("–ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç!")

# # –ü—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–ø—É—â–µ–Ω –ª–∏ —ç—Ç–æ—Ç –º–æ–¥—É–ª—å –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞ (–∞ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω)
# if __name__ == "__main__":
#     main()

# –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π –∏–≥—Ä—ã
from labyrinth_game.constants import COMMANDS, ROOMS, START_ROOM
from labyrinth_game.player_actions import move_player, show_items, take_item, use_item
from labyrinth_game.utils import (
    attempt_open_treasure,
    back,
    describe_room,
    get_input,
    solve_puzzle,
)

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞
game_state = {
    'items': [],  # –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏–≥—Ä–æ–∫–∞ ['torch', 'rusty_key' –∏—Ç–¥.]
    'rooms': ROOMS,   
    'current_room': START_ROOM, # 'entrance'
    'previous_room': None, # –°—Ç–∞—Ä—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–º–Ω–∞—Ç—ã
    'game_over': False, # –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
    'steps': 0,  # –°—á–µ—Ç—á–∏–∫ —Ö–æ–¥–æ–≤
    'puzzles_solved': set(), # –ü–æ–¥—Å—á—ë—Ç —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–≥–∞–¥–æ–∫
    'coins' : 0,
}

def show_help(COMMANDS):
    """
    –í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–æ–º–∞–Ω–¥–∞–º —Å –∫—Ä–∞—Å–∏–≤—ã–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º.
    Args:
        COMMANDS: —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∏–∑ constants.py
    """
    print("\nüìã –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:")
    for command in COMMANDS:
        # ‚úÖ 16 –ø—Ä–æ–±–µ–ª–æ–≤ + f-—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
        print(f"  {command:<16}")

# def show_help(): # –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤;
#     #–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –∏–≥—Ä—ã

#     '''–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥'''
#     print("\nüìã –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:")
#     print("  go | –∏–¥—Ç–∏ <–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ>      - –∏–¥—Ç–∏ (north, south, east, west)")
#     print("  back | –Ω–∞–∑–∞–¥                 - –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥")
#     print("  take | –≤–∑—è—Ç—å <item>          - –≤–∑—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç")
#     print("  use | –ø—Ä–∏–º–µ–Ω–∏—Ç—å <item>       - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç")
#     print("  look | –æ—Å–º–æ—Ç—Ä–µ—Ç—å             - –æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–Ω–∞—Ç—É")
#     print("  items | –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã            - –ø–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã")
#     print("  solve | —Ä–µ—à–∏—Ç—å               - —Ä–µ—à–∏—Ç—å –∑–∞–≥–∞–¥–∫—É")
#     print("  help | –ø–æ–º–æ—â—å                - –ø–æ–º–æ—â—å")
#     print("  exit | –≤—ã—Ö–æ–¥                 - –≤—ã—Ö–æ–¥ –∏–∑ –∏–≥—Ä—ã")


def process_command(game_state, command):
    '''
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —Å match/case.
    '''
    parts = command.lower().strip().split(maxsplit=1)
    action = parts[0] if parts else '' # –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ (–¥–µ–π—Å—Ç–≤–∏–µ) –∏–∑ parts
    arg = parts[1] if len(parts) > 1 else ''
    # –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç (–∞—Ä–≥—É–º–µ–Ω—Ç) –∏–∑ parts, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    
    match action:
        
        # ‚úÖ #1: –î–í–ò–ñ–ï–ù–ò–ï –ë–ï–ó 'go' (–ø—Ä—è–º—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
        case 'north' | '—Å–µ–≤–µ—Ä' | 'n':
            move_player(game_state, 'north')
        case 'south' | '—é–≥' | 's': 
            move_player(game_state, 'south')
        case 'east' | '–≤–æ—Å—Ç–æ–∫' | 'e':
            move_player(game_state, 'east')
        case 'west' | '–∑–∞–ø–∞–¥' | 'w':
            move_player(game_state, 'west')
            
        case 'go' | '–∏–¥—Ç–∏': 
            if arg:
                move_player(game_state, arg)
            # –∞—Ä–≥—É–º–µ–Ω—Ç —Ñ—É–Ω–∫—Ü–∏–∏ - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
            else:
                print("‚ùå –ö—É–¥–∞ –∏–¥—Ç–∏?")

        case 'back' | '–Ω–∞–∑–∞–¥' | '–≤–µ—Ä–Ω—É—Ç—å—Å—è':
            back(game_state)
        
        case 'take' | '–≤–∑—è—Ç—å':
        # –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞, –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤–∑—è—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –±–µ–∑ —Ä–µ—à–µ–Ω–∏—è –∑–∞–≥–∞–¥–∫–∏

            if not arg:
                print("‚ùå –ß—Ç–æ –≤–∑—è—Ç—å?")
                return
                
            current_room = game_state['current_room']
            room = ROOMS[current_room]
            
            # –ü–†–û–í–ï–†–ö–ê: –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∫–æ–º–Ω–∞—Ç–µ
            if not room.get('items'):
                print("‚ùå –í –∫–æ–º–Ω–∞—Ç–µ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤!")
                return
            
            # ‚úÖ –ü–†–û–í–ï–†–ö–ê: –µ—Å—Ç—å –ª–∏ –Ω–µ—Ä–µ—à—ë–Ω–Ω–∞—è –∑–∞–≥–∞–¥–∫–∞
            puzzles_solved = game_state.get('puzzles_solved', set())
            if room.get('puzzle') and current_room not in puzzles_solved:
            # if room.get('puzzle') and ('puzzles_solved'
            # not in game_state or current_room not in game_state['puzzles_solved']):
                print('''
                    "üß© –†–µ—à–∏ –∑–∞–≥–∞–¥–∫—É –∏ –Ω–∞–≥—Ä–∞–¥–∞ —Å—Ç–∞–Ω–µ—Ç —Ç–≤–æ–µ–π –ø–æ –ø—Ä–∞–≤—É.
                      –í–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É —Ä–µ—à–∏—Ç—å –∏–ª–∏ solve."
                      ''')
                return
            
            # ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã ‚Üí –±–µ—Ä—ë–º –ø—Ä–µ–¥–º–µ—Ç
            take_item(game_state, arg)
            
            # –±–ª–æ–∫ –∫–æ–¥–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã—Ö –∑–∞–≥–∞–¥–æ–∫
            # if arg: take_item(game_state, arg)
            # # –ï—Å–ª–∏ –µ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç take_item (–ø–æ–¥–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞)
            # else: print("‚ùå –ß—Ç–æ –≤–∑—è—Ç—å?")
        
        case 'use' | '–ø—Ä–∏–º–µ–Ω–∏—Ç—å':
            if arg:
                use_item(game_state, arg)
            # –í—ã–∑—ã–≤–∞–µ—Ç use_item —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º (–Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø—Ä–µ–¥–º–µ—Ç–∞)
            else:
                print("‚ùå –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?")
        
        case 'look' | '–æ—Å–º–æ—Ç—Ä–µ—Ç—å':
            describe_room(game_state) # –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–≤–æ–¥—è—â—É—é –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        
        case 'items' | '–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã':
            show_items(game_state)
            # –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞—é—â—É—é —Å–ø–∏—Å–æ–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞
        
        case 'help' | '–ø–æ–º–æ—â—å':
            show_help(COMMANDS) # –í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
        
        case 'quit' | 'exit' | '–≤—ã—Ö–æ–¥':
            game_state['game_over'] = True
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ True
            print("üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")

        # ‚úÖ –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥–∞–¥–æ–∫ + –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø treasure_room
        case 'solve' | '—Ä–µ—à–∏—Ç—å':
            if game_state['current_room'] == 'treasure_room':
                print("üíé –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å —Å–æ–∫—Ä–æ–≤–∏—â–µ!")
                attempt_open_treasure(game_state)  # ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
            else:
                solve_puzzle(game_state)  # –û–±—ã—á–Ω–∞—è –∑–∞–≥–∞–¥–∫–∞
              
        case _:
            print("üõë –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –í–≤–µ–¥–∏ 'help' –∏–ª–∏ '–ø–æ–º–æ—â—å' –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.")
    
def main():

    '''
    –§—É–Ω–∫—Ü–∏—è main() ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∏–≥—Ä—É.
    –û–Ω–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å:
    –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É
    –∏ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
    –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –∏–≥—Ä–æ–∫–∞ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã.
    '''

    print("üî• –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–∞–±–∏—Ä–∏–Ω—Ç —Å–æ–∫—Ä–æ–≤–∏—â! üî•")
    print('''
        "üéØ –¢–µ–±—è –∂–¥—ë—Ç –ø–æ–±–µ–¥–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ treasure_room
          –∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—É–Ω–¥—É–∫–∞ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ (treasure_chest)!"
          ''')
    describe_room(game_state)
    
    while not game_state['game_over']:
        # –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –∏–≥—Ä–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        # game_state['game_over'] ‚Äî —Ñ–ª–∞–≥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏–≥—Ä—ã:
        # False ‚Äî –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Üí —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç
        # True ‚Äî –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Üí —Ü–∏–∫–ª –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
        try: 
            # –Ω–∞—á–∏–Ω–∞–µ—Ç –±–ª–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É
            # –æ—Ç –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö
            # (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–∞–∂–º—ë—Ç Ctrl+C)

            cmd = get_input("–í–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É: (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏ help –∏–ª–∏ –ø–æ–º–æ—â—å)\n> ")
            # –í—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –ü–µ—Ä–µ–¥–∞—ë—Ç –≤–≤–µ–¥—ë–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ñ—É–Ω–∫—Ü–∏—é process_command()
            # –≠—Ñ—Ñ–µ–∫—Ç: –∏–≥—Ä–æ–∫ –≤–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, go north), –æ–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
            process_command(game_state, cmd)
            # –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
            # (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –ø–æ–¥–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –∏ —Ç. –¥.)

        except (KeyboardInterrupt, EOFError): # –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è 2 —Ç–∏–ø–æ–≤
            print("\nüëã –í—ã—Ö–æ–¥.")
            break

if __name__ == "__main__":
    # –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–∞–ø—Ä—è–º—É—é (–∞ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –º–æ–¥—É–ª—å)
    # –ï—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—â–µ–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, __name__ –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω "__main__"
    # –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –¥—Ä—É–≥–æ–π —Å–∫—Ä–∏–ø—Ç, —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
    # (—á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–≥—Ä—É —Å–ª—É—á–∞–π–Ω–æ)
    main()
    # –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é main(), –∫–æ—Ç–æ—Ä–∞—è:
    # –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ;
    # –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É;
    # –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª.
    # C—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞–ø—Ä—è–º—É—é
